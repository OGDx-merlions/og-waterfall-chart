{"version":3,"sources":["og-waterfall-chart.es6.js"],"names":["Polymer","is","properties","data","type","Array","value","observer","startingValue","Object","label","floorValue","Number","ceilingValue","yAxisTicks","yTickInterval","yAxisLabel","String","isChartBuilt","Boolean","readOnly","innerDimensions","width","height","legends","color","barPadding","barMaxWidth","chartMargins","top","right","bottom","left","notResponsive","listeners","barClick","d","i","fire","index","bubbles","ready","scopeSubtree","$","waterSVG","legendWrap","attached","draw","d3","Px","me","margin","svg","select","attr","append","cumulative","forEach","isComputed","class","start","end","isStarting","name","ceilDiff","max","intervalMultiplier","Math","ceil","ceilAdd","ceiling","x","scaleBand","rangeRound","paddingInner","y","scaleLinear","range","clamp","domain","map","g","barWidth","bandwidth","xAxis","axisBottom","tickFormat","l","length","yAxis","axisLeft","ticks","tickValues","call","selectAll","_wrapText","tickSize","formatComma","format","bar","enter","on","bind","abs","text","filter","_addLegend","each","words","split","reverse","word","line","lineNumber","lineHeight","dy","parseFloat","tspan","pop","push","join","node","getComputedTextLength","legWrap","newData","oldData","console","log","dom","innerHTML"],"mappings":"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","file":"og-waterfall-chart.js","sourcesContent":["(function() {\n  Polymer({\n\n    is: 'og-waterfall-chart',\n\n    properties:{\n      data: {\n        type: Array,\n        value: [],\n        observer: '_dataChanged'\n      },\n      startingValue: {\n        type: Object,\n        value: {\n          label: \"Clean\",\n          value: 97505\n        }\n      },\n      floorValue: {\n        type: Number,\n        value: 96000\n      },\n      ceilingValue: {\n        type: Number,\n        value: 0\n      },\n      yAxisTicks: {\n        type: Number,\n        value: 5\n      },\n      yTickInterval: {\n        type: Number,\n        value: 500\n      },\n      yAxisLabel: {\n        type: String,\n        value: \"\" //LNG mass flow in kg/h\"\n      },\n      isChartBuilt: {\n        type: Boolean,\n        value: false,\n        readOnly: true\n      },\n      innerDimensions: {\n        type: Object,\n        readOnly: true,\n        value: {\n          width: 960,\n          height: 500\n        }\n      },\n      legends: {\n        type: Array,\n        value: [\n          { label: \"Increase\", color: \"#d43875\" },\n          { label: \"Decrease\", color: \"#e2913b\" },\n          { label: \"Total\", color: \"#5fbcf8\" }\n        ]\n      },\n      //chart appearance related properties\n      width: {\n        type: String,\n        value: \"100%\"\n      },\n      height: {\n        type: String,\n        value: \"300px\"\n      },\n      barPadding: {\n        type: Number,\n        value: 0.3\n      },\n      barMaxWidth: {\n        type: Number,\n        value: 50\n      },\n      chartMargins: {\n        type: Object,\n        value: {top: 40, right: 10, bottom: 100, left: 50 }\n      },\n      notResponsive: {\n        type: Boolean,\n        value: false\n      }\n    },\n\n    listeners: {\n      'barClick': 'barClick'\n    },\n\n    barClick(d, i) {\n      this.fire('bar-click', {data: d, index: i}, {\n        bubbles: false\n      });\n    },\n\n    ready(){\n      this.scopeSubtree(this.$.waterSVG, true);\n      this.scopeSubtree(this.$.legendWrap, true);\n\n    },\n\n    attached(){\n      this.draw();\n    },\n\n    draw(){\n      let d3 = Px.d3\n        , me = this\n        , data = this.data;\n\n      let margin = {top: 20, right: 20, bottom: 30, left: 50},\n\t\t\t\t\twidth = this.width - margin.left - margin.right,\n\t\t\t\t\theight = this.height - margin.top - margin.bottom;\n\n      let svg = d3.select(this.$.waterSVG)\n\t\t\t\t\t.attr(\"viewBox\", \"0 0 \"+this.width+\" \"+this.height)\n\t\t\t\t\t.attr(\"preserveAspectRatio\", \"xMidYMid meet\")\n\t\t\t\t.append(\"g\")\n\t\t\t\t\t.attr(\"transform\",\n\t\t\t\t\t\t\t\t\"translate(\" + margin.left + \",\" + margin.top + \")\");\n\n      let cumulative = +this.startingValue;\n\n      //process data\n\t\t\tdata.forEach(function(d) {\n        if(d.isComputed){\n          d.class = 'total';\n          d.start = me.floorValue;\n          d.end = cumulative;\n        }\n        else{\n          d.start = (cumulative < me.floorValue) ? me.floorValue : cumulative;\n          d.class = (d.value<0) ? \"decrease\":\"increase\";\n        }\n\n        cumulative += d.value;\n\n        if(d.isStarting){\n          d.end = +me.startingValue;\n          d.start = me.floorValue;\n          d.class = 'total';\n          cumulative = +me.startingValue;\n        }\n        else{\n          if(!d.isComputed)\n            d.end = cumulative;\n        }\n\n        d.label = (d.label) ? d.label:d.name;\n\t\t\t});\n\n      //set ranges\n      let ceilDiff = +this.ceilingValue - d3.max(data, function(d) { return d.end; })\n        , intervalMultiplier = Math.ceil(ceilDiff / me.yTickInterval)\n        , ceilAdd = intervalMultiplier * me.yTickInterval\n        , ceiling = d3.max(data, (d) => d.end ) + ((+me.ceilingValue == 0) ? me.yTickInterval : ceilAdd);\n\n        // console.log(d3.max(data, (d) => { return d.end; }));\n      let x = d3.scaleBand().rangeRound([0, width]).paddingInner(0.05);\n\t\t\tlet y = d3.scaleLinear().range([height, 0]).clamp(true);\n\n      x.domain(data.map((d) => d.name ));\n      //y column domain, from 0 to the biggest end value\n      //if this chart is going to display negatives then it should use d3.min(data, function(d){ return d.start })\n      y.domain([me.floorValue, ceiling]);\n\n      svg.append(\"g\").attr(\"class\", \"container\");\n      let g = svg.select(\".container\");\n\n      //build axes\n      //to display the X axis on the chart\n      let barWidth = (x.bandwidth() > me.barMaxWidth) ? me.barMaxWidth : x.bandwidth();\n\n      let xAxis = d3.axisBottom(x).tickFormat((d) => {\n                //fetch the label field\n                //TODO: need to refactor this\n                for(var l=0; l<data.length; l++)\n                  if(data[l].name == d)\n                    return data[l].label;\n              });\n      let yAxis = d3.axisLeft(y).ticks(me.yAxisTicks)\n            .tickFormat((d) => d ).tickValues(d3.range(me.floorValue, ceiling, me.yTickInterval));\n\n      // console.log(data);\n\n      g.append(\"g\")\n        .attr(\"class\", \"x axis\")\n        .attr(\"transform\", \"translate(-20,\" + (me.height - 50) + \")\")\n        .call(xAxis)\n        .selectAll(\"text\")\n        .attr(\"y\", 15)\n        .attr(\"x\", 0)\n        .attr(\"dy\", \".35em\")\n        .call(me._wrapText, barWidth);\n\n      //to display the Y axis on the chart\n      g.append(\"g\")\n          .attr(\"class\", \"y axis\")\n          .call(yAxis);\n      //this is for the grid\n      g.append(\"g\")\n        .attr(\"class\", \"grid\")\n        .call(yAxis\n            .tickSize(-me.width)\n            .tickFormat(\"\")\n        );\n\n      let formatComma = d3.format(\",\");\n      //\n      // //adding each bar from the data\n      // //this are the columns. the gaps between them are based on the x() function created above\n      let bar = g.selectAll(\".bar\")\n          .data(data)\n          .enter().append(\"g\")\n          .attr(\"class\", (d) => \"bar \" + d.class )\n          .attr(\"transform\", (d) => \"translate(\" + x(d.name) + \",0)\" )\n          .on(\"click\", me.barClick.bind(me));\n\n      //on each column we add the actual bars that will appear\n      //the position(\"y\") is based on either the start or end (whichever is bigger of the 2)\n      //the height of the bar is based on the difference of start and end (no negatives)\n      bar.append(\"rect\")\n          .attr(\"y\", (d) => y( Math.max(d.start, d.end) ) )\n          .attr(\"height\", (d) => { return Math.abs( y(d.start) - y(d.end) ); })\n          .attr(\"width\", barWidth)\n          .attr(\"class\", (d) => {\n              return (d.color) ? \"\":\"no-color\";\n          })\n          .attr(\"fill\", function(d) {\n            if(d.color)\n              return d.color;\n          });\n\n      // //this is text that appears on the bar\n      bar.append(\"text\")\n          .attr(\"x\", barWidth / 2)\n          .attr(\"y\", (d) => {\n            return (d.class==\"decrease\") ? y(d.end) : y(d.end) - 10;\n          })\n          .attr(\"dy\", (d) => { return ((d.class=='negative') ? '-' : '') + \".75em\" })\n          .text((d) => { return (d.class==\"total\") ? formatComma(d.end) : formatComma(d.end - d.start);});\n      //\n      bar.filter((d) => { return d.class != \"total\" }).append(\"line\")\n          .attr(\"class\", \"connector\")\n          .attr(\"x1\", barWidth )\n          .attr(\"y1\", function(d) { return y(d.end) } )\n          .attr(\"x2\", x.bandwidth() / ( 1 - me.barPadding) - 5 )\n          .attr(\"y2\", function(d) { return y(d.end) } )\n\n      me._addLegend();\n    },\n\n    barClick(d, i){\n      this.fire('bar-click', {data: d, index: i}, {\n        bubbles: false\n      });\n    },\n\n    _wrapText(text, width) {\n      text.each(function() {\n        var text = d3.select(this),\n            words = text.text().split(/\\s+/).reverse(),\n            word,\n            line = [],\n            lineNumber = 0,\n            lineHeight = 1.1, // ems\n            y = text.attr(\"y\"),\n            dy = parseFloat(text.attr(\"dy\")),\n            tspan = text.text(null).append(\"tspan\").attr(\"x\", 0).attr(\"y\", y).attr(\"dy\", dy + \"em\");\n        while (word = words.pop()) {\n          line.push(word);\n          tspan.text(line.join(\" \"));\n          if (tspan.node().getComputedTextLength() > width || tspan.node().getComputedTextLength() == 0) {\n            line.pop();\n            tspan.text(line.join(\" \"));\n            line = [word];\n            tspan = text.append(\"tspan\").attr(\"x\", 0).attr(\"y\", y).attr(\"dy\", ++lineNumber * lineHeight + dy + \"em\").text(word);\n          }\n        }\n      });\n    },\n\n    _addLegend(){\n      if(!this.legends || this.legends.length == 0)\n        return false;\n\n      for(let i=0; i<this.legends.length; i++){\n        let legWrap = d3.select(this.$.legendWrap)\n          .append(\"span\").attr(\"class\",\"legend-wrap\");\n\n        legWrap.append(\"span\").attr(\"class\",\"leg-text\")\n          .attr(\"style\", \"border-left: .3rem solid \"+this.legends[i].color)\n          .text(this.legends[i].label);\n      }\n    },\n\n    _dataChanged(newData, oldData){\n      console.log(\"drawing\",newData, oldData);\n      if(newData && newData.length) {\n\t\t\t\tPolymer.dom(this.$.waterSVG).node.innerHTML = \"\";\n        Polymer.dom(this.$.legendWrap).node.innerHTML = \"\";\n\t\t\t\tthis.draw();\n\t\t\t}\n    }\n  });\n})();\n"]}