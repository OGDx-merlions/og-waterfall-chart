{"version":3,"sources":["og-waterfall-chart.es6.js"],"names":["Polymer","is","properties","data","type","Array","value","observer","startingValue","Object","label","floorValue","Number","ceilingValue","yAxisTicks","yTickInterval","yAxisLabel","String","isChartBuilt","Boolean","readOnly","innerDimensions","width","height","legends","color","barPadding","barMaxWidth","chartMargins","top","right","bottom","left","notResponsive","listeners","barClick","d","i","fire","index","bubbles","ready","scopeSubtree","$","waterSVG","legendWrap","attached","length","draw","d3","Px","me","margin","isNaN","svg","select","attr","append","cumulative","forEach","isComputed","class","start","end","isStarting","name","ceilDiff","max","intervalMultiplier","Math","ceil","ceilAdd","ceiling","x","scaleBand","rangeRound","paddingInner","y","scaleLinear","range","clamp","domain","map","g","barWidth","bandwidth","xAxis","axisBottom","tickFormat","l","yAxis","axisLeft","ticks","tickValues","call","selectAll","_wrapText","tickSize","formatComma","format","bar","enter","on","bind","abs","text","filter","_addLegend","each","words","split","reverse","word","line","lineNumber","lineHeight","dy","parseFloat","tspan","pop","push","join","node","getComputedTextLength","legWrap","newData","oldData","dom","innerHTML"],"mappings":"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","file":"og-waterfall-chart.js","sourcesContent":["(function() {\n  Polymer({\n\n    is: 'og-waterfall-chart',\n\n    properties:{\n      data: {\n        type: Array,\n        value: [],\n        observer: '_dataChanged'\n      },\n      startingValue: {\n        type: Object,\n        value: {\n          label: \"Clean\",\n          value: 97505\n        }\n      },\n      floorValue: {\n        type: Number,\n        value: 96000\n      },\n      ceilingValue: {\n        type: Number,\n        value: 0\n      },\n      yAxisTicks: {\n        type: Number,\n        value: 5\n      },\n      yTickInterval: {\n        type: Number,\n        value: 500\n      },\n      yAxisLabel: {\n        type: String,\n        value: \"\" //LNG mass flow in kg/h\"\n      },\n      isChartBuilt: {\n        type: Boolean,\n        value: false,\n        readOnly: true\n      },\n      innerDimensions: {\n        type: Object,\n        readOnly: true,\n        value: {\n          width: 960,\n          height: 500\n        }\n      },\n      legends: {\n        type: Array,\n        value: [\n          { label: \"Increase\", color: \"#d43875\" },\n          { label: \"Decrease\", color: \"#e2913b\" },\n          { label: \"Total\", color: \"#5fbcf8\" }\n        ]\n      },\n      //chart appearance related properties\n      width: {\n        type: String,\n        value: \"100%\"\n      },\n      height: {\n        type: String,\n        value: \"300px\"\n      },\n      barPadding: {\n        type: Number,\n        value: 0.3\n      },\n      barMaxWidth: {\n        type: Number,\n        value: 50\n      },\n      chartMargins: {\n        type: Object,\n        value: {top: 40, right: 10, bottom: 100, left: 50 }\n      },\n      notResponsive: {\n        type: Boolean,\n        value: false\n      }\n    },\n\n    listeners: {\n      'barClick': 'barClick'\n    },\n\n    barClick(d, i) {\n      this.fire('bar-click', {data: d, index: i}, {\n        bubbles: false\n      });\n    },\n\n    ready(){\n      this.scopeSubtree(this.$.waterSVG, true);\n      this.scopeSubtree(this.$.legendWrap, true);\n\n    },\n\n    attached(){\n      if(this.data && this.data.length)\n        this.draw();\n    },\n\n    draw(){\n      let d3 = Px.d3\n        , me = this\n        , data = this.data;\n\n      let margin = {top: 20, right: 20, bottom: 30, left: 50},\n\t\t\t\t\twidth = this.width - margin.left - margin.right,\n\t\t\t\t\theight = this.height - margin.top - margin.bottom;\n\n      if(isNaN(width) || isNaN(height))\n        return false;\n\n      let svg = d3.select(this.$.waterSVG)\n\t\t\t\t\t.attr(\"viewBox\", \"0 0 \"+this.width+\" \"+this.height)\n\t\t\t\t\t.attr(\"preserveAspectRatio\", \"xMidYMid meet\")\n\t\t\t\t.append(\"g\")\n\t\t\t\t\t.attr(\"transform\",\n\t\t\t\t\t\t\t\t\"translate(\" + margin.left + \",\" + margin.top + \")\");\n\n      let cumulative = +this.startingValue;\n\n      //process data\n\t\t\tdata.forEach(function(d) {\n        if(d.isComputed){\n          d.class = 'total';\n          d.start = me.floorValue;\n          d.end = cumulative;\n        }\n        else{\n          d.start = (cumulative < me.floorValue) ? me.floorValue : cumulative;\n          d.class = (d.value<0) ? \"decrease\":\"increase\";\n        }\n\n        cumulative += d.value;\n\n        if(d.isStarting){\n          d.end = +me.startingValue;\n          d.start = me.floorValue;\n          d.class = 'total';\n          cumulative = +me.startingValue;\n        }\n        else{\n          if(!d.isComputed)\n            d.end = cumulative;\n        }\n\n        d.label = (d.label) ? d.label:d.name;\n\t\t\t});\n\n      //set ranges\n      let ceilDiff = +this.ceilingValue - d3.max(data, function(d) { return d.end; })\n        , intervalMultiplier = Math.ceil(ceilDiff / me.yTickInterval)\n        , ceilAdd = intervalMultiplier * me.yTickInterval\n        , ceiling = (+this.ceilingValue == 0) ? (d3.max(data, (d) => d.end ) + ((+me.ceilingValue == 0) ? me.yTickInterval : ceilAdd)) : (+this.ceilingValue + me.yTickInterval);\n\n        // console.log(d3.max(data, (d) => { return d.end; }));\n      let x = d3.scaleBand().rangeRound([0, width]).paddingInner(0.05);\n\t\t\tlet y = d3.scaleLinear().range([height, 0]).clamp(true);\n\n      x.domain(data.map((d) => d.name ));\n      //y column domain, from 0 to the biggest end value\n      //if this chart is going to display negatives then it should use d3.min(data, function(d){ return d.start })\n      y.domain([me.floorValue, ceiling]);\n\n      svg.append(\"g\").attr(\"class\", \"container\");\n      let g = svg.select(\".container\");\n\n      //build axes\n      //to display the X axis on the chart\n      let barWidth = (x.bandwidth() > me.barMaxWidth) ? me.barMaxWidth : x.bandwidth();\n\n      let xAxis = d3.axisBottom(x).tickFormat((d) => {\n                //fetch the label field\n                //TODO: need to refactor this\n                for(var l=0; l<data.length; l++)\n                  if(data[l].name == d)\n                    return data[l].label;\n              });\n      let yAxis = d3.axisLeft(y).ticks(me.yAxisTicks)\n            .tickFormat((d) => d ).tickValues(d3.range(me.floorValue, ceiling, me.yTickInterval));\n\n      // console.log(data);\n\n      g.append(\"g\")\n        .attr(\"class\", \"x axis\")\n        .attr(\"transform\", \"translate(-20,\" + (me.height - 50) + \")\")\n        .call(xAxis)\n        .selectAll(\"text\")\n        .attr(\"y\", 15)\n        .attr(\"x\", 0)\n        .attr(\"dy\", \".35em\")\n        .call(me._wrapText, barWidth);\n\n      //to display the Y axis on the chart\n      g.append(\"g\")\n          .attr(\"class\", \"y axis\")\n          .call(yAxis);\n      //this is for the grid\n      g.append(\"g\")\n        .attr(\"class\", \"grid\")\n        .call(yAxis\n            .tickSize(-me.width)\n            .tickFormat(\"\")\n        );\n\n      let formatComma = d3.format(\",\");\n      //\n      // //adding each bar from the data\n      // //this are the columns. the gaps between them are based on the x() function created above\n      let bar = g.selectAll(\".bar\")\n          .data(data)\n          .enter().append(\"g\")\n          .attr(\"class\", (d) => \"bar \" + d.class )\n          .attr(\"transform\", (d) => \"translate(\" + x(d.name) + \",0)\" )\n          .on(\"click\", me.barClick.bind(me));\n\n      //on each column we add the actual bars that will appear\n      //the position(\"y\") is based on either the start or end (whichever is bigger of the 2)\n      //the height of the bar is based on the difference of start and end (no negatives)\n      bar.append(\"rect\")\n          .attr(\"y\", (d) => y( Math.max(d.start, d.end) ) )\n          .attr(\"height\", (d) => { return Math.abs( y(d.start) - y(d.end) ); })\n          .attr(\"width\", barWidth)\n          .attr(\"class\", (d) => {\n              return (d.color) ? \"\":\"no-color\";\n          })\n          .attr(\"fill\", function(d) {\n            if(d.color)\n              return d.color;\n          });\n\n      // //this is text that appears on the bar\n      bar.append(\"text\")\n          .attr(\"x\", barWidth / 2)\n          .attr(\"y\", (d) => {\n            return (d.class==\"decrease\") ? y(d.end) : y(d.end) - 10;\n          })\n          .attr(\"dy\", (d) => { return ((d.class=='negative') ? '-' : '') + \".75em\" })\n          .text((d) => { return (d.class==\"total\") ? formatComma(d.end) : formatComma(d.end - d.start);});\n      //\n      bar.filter((d) => { return d.class != \"total\" }).append(\"line\")\n          .attr(\"class\", \"connector\")\n          .attr(\"x1\", barWidth )\n          .attr(\"y1\", function(d) { return y(d.end) } )\n          .attr(\"x2\", x.bandwidth() / ( 1 - me.barPadding) - 5 )\n          .attr(\"y2\", function(d) { return y(d.end) } )\n\n      me._addLegend();\n    },\n\n    barClick(d, i){\n      this.fire('bar-click', {data: d, index: i}, {\n        bubbles: false\n      });\n    },\n\n    _wrapText(text, width) {\n      text.each(function() {\n        var text = d3.select(this),\n            words = text.text().split(/\\s+/).reverse(),\n            word,\n            line = [],\n            lineNumber = 0,\n            lineHeight = 1.1, // ems\n            y = text.attr(\"y\"),\n            dy = parseFloat(text.attr(\"dy\")),\n            tspan = text.text(null).append(\"tspan\").attr(\"x\", 0).attr(\"y\", y).attr(\"dy\", dy + \"em\");\n        while (word = words.pop()) {\n          line.push(word);\n          tspan.text(line.join(\" \"));\n          if (tspan.node().getComputedTextLength() > width || tspan.node().getComputedTextLength() == 0) {\n            line.pop();\n            tspan.text(line.join(\" \"));\n            line = [word];\n            tspan = text.append(\"tspan\").attr(\"x\", 0).attr(\"y\", y).attr(\"dy\", ++lineNumber * lineHeight + dy + \"em\").text(word);\n          }\n        }\n      });\n    },\n\n    _addLegend(){\n      if(!this.legends || this.legends.length == 0)\n        return false;\n\n      for(let i=0; i<this.legends.length; i++){\n        let legWrap = d3.select(this.$.legendWrap)\n          .append(\"span\").attr(\"class\",\"legend-wrap\");\n\n        legWrap.append(\"span\").attr(\"class\",\"leg-text\")\n          .attr(\"style\", \"border-left: .3rem solid \"+this.legends[i].color)\n          .text(this.legends[i].label);\n      }\n    },\n\n    _dataChanged(newData, oldData){\n      if(newData && newData.length) {\n\t\t\t\tPolymer.dom(this.$.waterSVG).node.innerHTML = \"\";\n        Polymer.dom(this.$.legendWrap).node.innerHTML = \"\";\n\t\t\t\tthis.draw();\n\t\t\t}\n    }\n  });\n})();\n"]}