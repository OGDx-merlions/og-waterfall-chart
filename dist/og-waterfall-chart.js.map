{"version":3,"sources":["og-waterfall-chart.es6.js"],"names":["Polymer","is","properties","data","type","Array","value","observer","startingValue","Object","label","floorValue","Number","yAxisTicks","yTickInterval","yAxisLabel","String","isChartBuilt","Boolean","readOnly","innerDimensions","width","height","legends","color","barPadding","chartMargins","top","right","bottom","left","notResponsive","listeners","barClick","d","i","fire","index","bubbles","redrawChart","svg","d3","select","compStyles","node","parseInt","clientWidth","margin","_setInnerDimensions","remove","_buildChart","ready","scopeSubtree","$","waterSVG","attached","length","chart","window","on","_resize","bind","_processData","cumulative","currentGrp","groupName","push","name","end","start","class","g","values","currBar","groupNament","_xyBounds","bounds","ceiling","max","x","scaleBand","rangeRound","paddingInner","y","scaleLinear","domain","map","_axes","axes","xAxis","axisBottom","tickFormat","l","yAxis","axisLeft","ticks","tickValues","range","_buildAxes","append","attr","call","selectAll","style","tickSize","_buildBars","formatComma","format","bar","enter","Math","abs","bandwidth","text","filter","_addLegend","_setIsChartBuilt","leg","_dataChanged"],"mappings":"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","file":"og-waterfall-chart.js","sourcesContent":["(function() {\n  Polymer({\n\n    is: 'og-waterfall-chart',\n\n    properties:{\n      data: {\n        type: Array,\n        value: [],\n        observer: '_dataChanged'\n      },\n      startingValue: {\n        type: Object,\n        value: {\n          label: \"Clean\",\n          value: 97505\n        }\n      },\n      floorValue: {\n        type: Number,\n        value: 96000\n      },\n      yAxisTicks: {\n        type: Number,\n        value: 5\n      },\n      yTickInterval: {\n        type: Number,\n        value: 500\n      },\n      yAxisLabel: {\n        type: String,\n        value: \"LNG mass flow in kg/h\"\n      },\n      isChartBuilt: {\n        type: Boolean,\n        value: false,\n        readOnly: true\n      },\n      innerDimensions: {\n        type: Object,\n        readOnly: true,\n        value: {\n          width: 960,\n          height: 500\n        }\n      },\n      legends: {\n        type: Array,\n        value: [\n          { label: \"Increase\", color: \"#5b9bd5\" },\n          { label: \"Decrease\", color: \"#ed7d31\" },\n          { label: \"Total\", color: \"#a5a5a5\" }\n        ]\n      },\n      //chart appearance related properties\n      width: {\n        type: String,\n        value: \"100%\"\n      },\n      height: {\n        type: String,\n        value: \"300px\"\n      },\n      barPadding: {\n        type: Number,\n        value: 0.3\n      },\n      chartMargins: {\n        type: Object,\n        value: {top: 20, right: 30, bottom: 100, left: 40 }\n      },\n      notResponsive: {\n        type: Boolean,\n        value: false\n      }\n    },\n\n    listeners: {\n      'barClick': 'barClick'\n    },\n\n    barClick: function(d, i) {\n      this.fire('bar-click', {data: d, index: i}, {\n        bubbles: false\n      });\n    },\n\n    redrawChart: function(){\n      // window.setTimeout(function(){\n      var svg = d3.select(\"#waterSVG\")\n        , compStyles = d3.select(\"#chart\").node()\n        , width = parseInt(compStyles.clientWidth + 150)\n        , height = parseInt(this.height)\n        , margin = this.chartMargins;\n      // console.log(d3.select(\"#chart\").node().clientWidth);\n      if(compStyles.clientWidth > 0){\n        this._setInnerDimensions({\n            width: width - margin.left - margin.right,\n            height: height  - margin.top - margin.bottom\n          });\n\n        svg.select(\".container\").remove();\n        svg.select(\".legend\").remove();\n\n        this._buildChart(svg);\n      }\n    },\n\n    ready: function(){\n      this.scopeSubtree(this.$.waterSVG, true);\n    },\n\n    attached: function(){\n      //if data is just empty then we can't continue building the chart\n      if(!this.data || this.data.length == 0)\n        return false;\n\n      //TODO: remove this and just add a default height and width, let the window resize take care of this.\n      var compStyles = d3.select(this.$.chart).node() //window.getComputedStyle(d3.select(\"#chart\").node())\n        , clientWidth = (compStyles.clientWidth==0) ? 960 : compStyles.clientWidth\n        , width = (!this.notResponsive) ? parseInt(clientWidth) : this.width\n        , height = this.height;\n\n      var svg = d3.select(this.$.waterSVG);\n      var margin = this.chartMargins;\n\n      this._setInnerDimensions({\n          width: width - margin.left - margin.right,\n          height: this.height  - margin.top - margin.bottom\n        });\n\n      if(this.yAxisLabel != \"\")\n        margin.left += 50;\n\n      this._buildChart(svg);\n\n      if(!this.notResponsive)\n        d3.select(window).on('resize', this._resize.bind(this));\n    },\n\n    _processData: function(){\n      if(!this.data || this.data.length == 0)\n        return [];\n\n      var data = []\n        , cumulative = this.startingValue.value\n        , currentGrp = this.data[0].groupName;\n\n      data.push({\n        name: this.data[0].groupName+'Total',\n        end: this.startingValue.value,\n        start: this.floorValue,\n        class: 'total',\n        label: 'Clean' //TODO: need to make this as a property\n      });\n      for(var i=0; i<this.data.length; i++){\n        for(var g=0; g<this.data[i].values.length; g++){\n          var currBar = this.data[i].values[g];\n          currBar.name = currBar.name + this.data[i].groupName;\n          currBar.class = this.data[i].groupName;\n          currBar.start = (cumulative < this.floorValue) ? this.floorValue : cumulative;\n          cumulative += this.data[i].values[g].value;\n          currBar.end = cumulative;\n          currBar.label = this.data[i].values[g].label;\n          data.push(currBar);\n        }\n        currentGrp = this.data[i].groupName;\n\n        if(currentGrp != this.data[i].groupNament){//create a total column\n          data.push({\n            name: 'Total' + i,\n            end: cumulative,\n            start: this.floorValue,\n            class: 'total',\n            //TODO: Need to find a better way to set the middle label\n            label: i==0 ? 'all degraded' : 'Clean'\n          });\n        }\n      }\n\n      return data;\n    },\n\n    _xyBounds: function(data){\n      var bounds = {\n        ceiling: d3.max(data, function(d) { return d.end; }) + this.yTickInterval,\n        x: d3.scaleBand()\n                .rangeRound([0, this.innerDimensions.width])\n                .paddingInner(0.05),\n        y: d3.scaleLinear()\n                .rangeRound([this.innerDimensions.height, 0])\n      }\n\n      //x column domain\n      bounds.x.domain(data.map(function(d) { return d.name; }));\n      //y column domain, from 0 to the biggest end value\n      //if this chart is going to display negatives then it should use d3.min(data, function(d){ return d.start })\n      bounds.y.domain([this.floorValue, bounds.ceiling]);\n\n      return bounds;\n    },\n\n    _axes: function(data, bounds){\n      var axes = {\n        xAxis: d3.axisBottom(bounds.x).tickFormat(function(d){\n              //fetch the label field\n              //TODO: need to refactor this\n              for(var l=0; l<data.length; l++)\n                if(data[l].name == d)\n                  return data[l].label;\n            }),\n        yAxis: d3.axisLeft(bounds.y).ticks(this.yAxisTicks).tickValues(d3.range(this.floorValue, bounds.ceiling, this.yTickInterval))\n      }\n\n      return axes;\n    },\n\n    _buildAxes: function(axes, g){\n      //to display the X axis on the chart\n\n      g.append(\"g\")\n        .attr(\"class\", \"x axis\")\n        .attr(\"transform\", \"translate(0,\" + this.innerDimensions.height + \")\")\n        .call(axes.xAxis)\n        .selectAll(\"text\")\n        .attr(\"y\", 20)\n        .attr(\"x\", -20)\n        .attr(\"dy\", \".35em\")\n        .attr(\"transform\", \"rotate(-60)\")\n        .style(\"text-anchor\", \"end\");\n\n\n      //to display the Y axis on the chart\n      g.append(\"g\")\n          .attr(\"class\", \"y axis\")\n          .call(axes.yAxis);\n\n      g.append(\"g\")\n        .attr(\"class\", \"grid\")\n        .call(axes.yAxis\n            .tickSize(-this.innerDimensions.width)\n            .tickFormat(\"\")\n        );\n    },\n\n    _buildBars: function(data, g, x, y){\n      var formatComma = d3.format(\",\");\n\n      //adding each bar from the data\n      //this are the columns. the gaps between them are based on the x() function created above\n      var bar = g.selectAll(\".bar\")\n          .data(data)\n          .enter().append(\"g\")\n          .attr(\"class\", function(d) { return \"bar \" + d.class })\n          .attr(\"transform\", function(d) { return \"translate(\" + x(d.name) + \",0)\"; })\n          .on(\"click\", this.barClick.bind(this));\n\n      //on each column we add the actual bars that will appear\n      //the position(\"y\") is based on either the start or end (whichever is bigger of the 2)\n      //the height of the bar is based on the difference of start and end (no negatives)\n      bar.append(\"rect\")\n          .attr(\"y\", function(d) { return y( Math.max(d.start, d.end) ); })\n          .attr(\"height\", function(d) { return Math.abs( y(d.start) - y(d.end) ); })\n          .attr(\"width\", x.bandwidth());\n\n      //this is text that appears on the bar\n      bar.append(\"text\")\n          .attr(\"x\", x.bandwidth() / 2)\n          .attr(\"y\", function(d) {\n            return d.class==\"decrease\" ? y(d.end) : y(d.end) - 10;\n          })\n          .attr(\"dy\", function(d) { return ((d.class=='negative') ? '-' : '') + \".75em\" })\n          .text(function(d) { return (d.class==\"total\") ? formatComma(d.end) : formatComma(d.end - d.start);});\n\n      bar.filter(function(d) { return d.class != \"total\" }).append(\"line\")\n          .attr(\"class\", \"connector\")\n          .attr(\"x1\", x.bandwidth() + 5 )\n          .attr(\"y1\", function(d) { return y(d.end) } )\n          .attr(\"x2\", x.bandwidth() / ( 1 - this.barPadding) - 5 )\n          .attr(\"y2\", function(d) { return y(d.end) } )\n    },\n\n    _buildChart: function(svg){\n      var margin = this.chartMargins;\n\n      //transform the data that the start and end properties are added\n      //the start of each data should be the value of the cumulative value so far\n      var data = this._processData();\n\n      //setting x and y scales based on the dimensions of the SVG\n      var bounds = this._xyBounds(data)\n        , axes = this._axes(data, bounds);\n\n      var x = bounds.x\n        , y = bounds.y;\n\n      svg.attr(\"width\", this.innerDimensions.width + margin.left + margin.right)\n          .attr(\"height\", this.innerDimensions.height + margin.top + margin.bottom)//this.innerDimensions.height + margin.top + margin.bottom)\n          .append(\"g\").attr(\"class\", \"container\")\n          .attr(\"transform\", \"translate(\" + margin.left + \",\" + margin.top + \")\");\n\n      var g = svg.select(\".container\");\n\n      this._buildAxes(axes, g);\n\n      this._buildBars(data, g, x, y);\n\n      this._addLegend(svg);\n\n      // text label for the y axis\n      if(this.yAxisLabel != \"\")\n        g.append(\"text\")\n            .attr(\"transform\", \"rotate(-90)\")\n            .attr(\"y\", 10 - margin.left)\n            .attr(\"x\",0 - (this.height / 2))\n            .attr(\"dy\", \"1em\")\n            .style(\"text-anchor\", \"middle\")\n            .text(this.yAxisLabel);\n\n      this._setIsChartBuilt(true);\n    },\n\n    _addLegend: function(svg){\n      if(!this.legends || this.legends.length == 0)\n        return false;\n\n      var leg = svg.append(\"g\").attr(\"class\", \"legend\");\n\n      for(var i=0; i<this.legends.length; i++){\n        leg.append(\"rect\")\n        .attr(\"class\", \"leg-rect\")\n        .attr(\"x\", i * 100)\n        .attr(\"y\", 0)\n        .attr(\"width\", 10)\n        .attr(\"height\", 10)\n        .style(\"fill\", this.legends[i].color);\n\n        leg.append(\"text\")\n          .attr(\"x\", (i * 100) + 12)\n          .attr(\"y\", -5)\n          .attr(\"dy\", \"1em\")\n          .text(this.legends[i].label);\n        // .attr(\"x\", (this.width / 2))\n        //   .style(\"text-anchor\", \"middle\");\n      }\n\n      leg.attr(\"transform\", \"translate(\" + ((this.innerDimensions.width / 2) - ((this.legends.length*100 + 15*this.legends.length) / 2)) + \",0)\");\n    },\n\n    _dataChanged: function(){\n      if(this.isChartBuilt){\n        var svg = d3.select(this.$.waterSVG);\n\n        svg.select(\".container\").remove();\n\n        this._buildChart(svg);\n      }\n    },\n\n    _resize: function() {\n\n      var svg = d3.select(\"#waterSVG\")\n        , compStyles = d3.select(this.$.chart).node()\n        , width = parseInt(compStyles.clientWidth)\n        , height = parseInt(this.height)\n        , margin = this.chartMargins;\n\n      this._setInnerDimensions({\n          width: width - margin.left - margin.right,\n          height: height  - margin.top - margin.bottom\n        });\n\n      svg.select(\".container\").remove();\n      svg.select(\".legend\").remove();\n\n      this._buildChart(svg);\n    }\n  });\n})();\n"]}