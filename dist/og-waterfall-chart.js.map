{"version":3,"sources":["og-waterfall-chart.es6.js"],"names":["Polymer","is","properties","data","type","Array","value","observer","floorValue","Number","ceilingValue","yAxisTicks","yTickInterval","yTickFormat","String","yAxisLabel","isChartBuilt","Boolean","readOnly","innerDimensions","Object","width","height","legends","label","color","barTextFormat","barPadding","barMaxWidth","startingValue","margin","top","right","bottom","left","listeners","barClick","d","i","fire","index","bubbles","ready","scopeSubtree","$","waterSVG","legendWrap","attached","length","draw","d3","Px","me","isNaN","svg","select","attr","append","_setStartingValue","cumulative","forEach","isComputed","class","start","end","isStarting","name","ceilDiff","max","intervalMultiplier","Math","ceil","ceilAdd","ceiling","x","scaleBand","rangeRound","paddingInner","y","scaleLinear","range","clamp","domain","map","g","barWidth","bandwidth","innerMarginLeft","xAxis","axisBottom","tickFormat","l","yAxis","axisLeft","ticks","tickValues","format","call","selectAll","_wrapText","tickSize","text","formatComma","bar","enter","on","bind","abs","filter","_addLegend","each","words","split","reverse","word","line","lineNumber","lineHeight","dy","parseFloat","tspan","pop","push","join","compTextLen","node","getComputedTextLength","innerHTML","legWrap","newData","oldData","dom"],"mappings":"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","file":"og-waterfall-chart.js","sourcesContent":["(function() {\n  Polymer({\n\n    is: 'og-waterfall-chart',\n\n    properties:{\n      data: {\n        type: Array,\n        value: [],\n        observer: '_dataChanged'\n      },\n      floorValue: {\n        type: Number,\n        value: 96000\n      },\n      ceilingValue: {\n        type: Number,\n        value: 0\n      },\n      yAxisTicks: {\n        type: Number,\n        value: 5\n      },\n      yTickInterval: {\n        type: Number,\n        value: 500\n      },\n      yTickFormat: {\n        type: String,\n        value: \"\"\n      },\n      yAxisLabel: {\n        type: String,\n        value: \"\" //LNG mass flow in kg/h\"\n      },\n      isChartBuilt: {\n        type: Boolean,\n        value: false,\n        readOnly: true\n      },\n      innerDimensions: {\n        type: Object,\n        readOnly: true,\n        value: {\n          width: 960,\n          height: 500\n        }\n      },\n      legends: {\n        type: Array,\n        value: [\n          { label: \"Increase\", color: \"#d43875\" },\n          { label: \"Decrease\", color: \"#e2913b\" },\n          { label: \"Total\", color: \"#5fbcf8\" }\n        ]\n      },\n      barTextFormat: {\n        type: String,\n        value: \",\"\n      },\n      //chart appearance related properties\n      width: {\n        type: String,\n        value: \"100%\"\n      },\n      height: {\n        type: String,\n        value: \"300px\"\n      },\n      barPadding: {\n        type: Number,\n        value: 0.3\n      },\n      barMaxWidth: {\n        type: Number,\n        value: 50\n      },\n      startingValue: {\n        type: Number,\n        value: 0,\n        readOnly: true\n      },\n      margin: {\n        type: Object,\n        value() {\n          return {top: 20, right: 20, bottom: 50, left: 50};\n        },\n        observer: '_dataChanged'\n      }\n    },\n\n    listeners: {\n      'barClick': 'barClick'\n    },\n\n    barClick(d, i) {\n      this.fire('bar-click', {data: d, index: i}, {\n        bubbles: false\n      });\n    },\n\n    ready(){\n      this.scopeSubtree(this.$.waterSVG, true);\n      this.scopeSubtree(this.$.legendWrap, true);\n\n    },\n\n    attached(){\n      if(this.data && this.data.length)\n        this.draw();\n    },\n\n    draw(){\n      let d3 = Px.d3\n        , me = this\n        , data = this.data;\n\n      let margin = this.margin || {top: 20, right: 20, bottom: 50, left: 50},\n\t\t\t\t\twidth = this.width - margin.left - margin.right,\n          height = this.height - margin.top - margin.bottom;\n\n      if(isNaN(width) || isNaN(height))\n        return false;\n\n      let svg = d3.select(this.$.waterSVG)\n\t\t\t\t\t.attr(\"viewBox\", \"0 0 \"+this.width+\" \"+this.height)\n\t\t\t\t\t.attr(\"preserveAspectRatio\", \"xMidYMid meet\")\n\t\t\t\t.append(\"g\")\n\t\t\t\t\t.attr(\"transform\",\n\t\t\t\t\t\t\t\t\"translate(\" + margin.left + \",\" + margin.top + \")\");\n\n      this._setStartingValue(data[0].value)\n\n      let cumulative = +this.startingValue;\n\n      //process data\n\t\t\tdata.forEach(function(d) {\n        if(d.isComputed){\n          d.class = 'total';\n          d.start = me.floorValue;\n          d.end = cumulative;\n        }\n        else{\n          d.start = (cumulative < me.floorValue) ? me.floorValue : cumulative;\n          d.class = (d.value<0) ? \"decrease\":\"increase\";\n        }\n\n        cumulative += d.value;\n\n        if(d.isStarting){\n          d.end = +me.startingValue;\n          d.start = me.floorValue;\n          d.class = 'total';\n          cumulative = +me.startingValue;\n        }\n        else{\n          if(!d.isComputed)\n            d.end = cumulative;\n        }\n\n        d.label = (d.label) ? d.label:d.name;\n\t\t\t});\n\n      //set ranges\n      let ceilDiff = +this.ceilingValue - d3.max(data, function(d) { return d.end; })\n        , intervalMultiplier = Math.ceil(ceilDiff / me.yTickInterval)\n        , ceilAdd = intervalMultiplier * me.yTickInterval\n        , ceiling = (+this.ceilingValue == 0) ? (d3.max(data, (d) => d.end ) + ((+me.ceilingValue == 0) ? me.yTickInterval : ceilAdd)) : (+this.ceilingValue + .001);\n        // , ceiling = (d3.max(data, (d) => d.end ) + ((+me.ceilingValue == 0) ? me.yTickInterval : ceilAdd));\n\n        // console.log(d3.max(data, (d) => { return d.end; }));\n      let x = d3.scaleBand().rangeRound([0, width]).paddingInner(0.05);\n\t\t\tlet y = d3.scaleLinear().range([height, 0]).clamp(true);\n\n      x.domain(data.map((d) => d.name ));\n      //y column domain, from 0 to the biggest end value\n      //if this chart is going to display negatives then it should use d3.min(data, function(d){ return d.start })\n      y.domain([me.floorValue, ceiling]);\n\n      svg.append(\"g\").attr(\"class\", \"container\");\n      let g = svg.select(\".container\");\n\n      //build axes\n      //to display the X axis on the chart\n      let barWidth = (x.bandwidth() > me.barMaxWidth) ? me.barMaxWidth : x.bandwidth();\n      let innerMarginLeft = 30;\n\n      let xAxis = d3.axisBottom(x).tickFormat((d) => {\n                //fetch the label field\n                //TODO: need to refactor this\n                for(var l=0; l<data.length; l++)\n                  if(data[l].name == d)\n                    return data[l].label;\n              });\n      let yAxis = d3.axisLeft(y).ticks(me.yAxisTicks).tickValues(d3.range(me.floorValue, ceiling, me.yTickInterval));\n\n      if(this.yTickFormat != \"\") {\n        yAxis.tickFormat(d3.format(this.yTickFormat));\n      }\n      else {\n        yAxis.tickFormat((d) => d);\n      }\n\n      g.append(\"g\")\n        .attr(\"class\", \"x axis\")\n        .attr(\"transform\", \"translate(10,\" + (me.height - 70) + \")\")\n        .call(xAxis)\n        .selectAll(\"text\")\n        .attr(\"y\", 15)\n        .attr(\"x\", 0)\n        .attr(\"dy\", \".35em\")\n        .call(me._wrapText, barWidth);\n\n      //to display the Y axis on the chart\n      g.append(\"g\")\n          .attr(\"class\", \"y axis\")\n          .call(yAxis);\n      //this is for the grid\n      g.append(\"g\")\n        .attr(\"class\", \"grid\")\n        .call(yAxis\n            .tickSize(-me.width)\n            .tickFormat(\"\")\n        );\n\n      g.append(\"text\")\n\t\t\t\t.attr(\"transform\", \"rotate(-90)\")\n\t\t\t\t.attr(\"y\", 0 - margin.left)\n\t\t\t\t.attr(\"x\",0 - (height / 2))\n\t\t\t\t.attr(\"dy\", \"1em\")\n\t\t\t\t.attr(\"class\", \"yaxis-label\")\n\t\t\t\t.text(me.yAxisLabel);\n\n      let formatComma = d3.format(me.barTextFormat);\n      //\n      // //adding each bar from the data\n      // //this are the columns. the gaps between them are based on the x() function created above\n      let bar = g.selectAll(\".bar\")\n          .data(data)\n          .enter().append(\"g\")\n          .attr(\"class\", (d) => \"bar \" + d.class )\n          .attr(\"transform\", (d) => {\n            return \"translate(\" + (innerMarginLeft + (x(d.name) + ((x.bandwidth() / 2) - barWidth/2) - 20)) + \",0)\";\n          } )\n          .on(\"click\", me.barClick.bind(me));\n\n      //on each column we add the actual bars that will appear\n      //the position(\"y\") is based on either the start or end (whichever is bigger of the 2)\n      //the height of the bar is based on the difference of start and end (no negatives)\n      bar.append(\"rect\")\n          .attr(\"y\", (d) => y( Math.max(d.start, d.end) ) )\n          //TODO: set the x here so that the rec is i\n          .attr(\"x\", (d) => x(barWidth) )\n          .attr(\"height\", (d) => { return Math.abs( y(d.start) - y(d.end) ); })\n          .attr(\"width\", barWidth)\n          .attr(\"class\", (d) => {\n              return (d.color) ? \"\":\"no-color\";\n          })\n          .attr(\"fill\", function(d) {\n            if(d.color)\n              return d.color;\n          });\n\n      // //this is text that appears on the bar\n      bar.append(\"text\")\n          .attr(\"x\", barWidth / 2)\n          .attr(\"y\", (d) => {\n            return (d.class==\"decrease\") ? y(d.end) + 2 : y(d.end) - 12;\n          })\n          .attr(\"dy\", (d) => { return ((d.class=='negative') ? '-' : '') + \".75em\" })\n          .text((d) => { return (d.class==\"total\") ? formatComma(d.end) : formatComma(d.end - d.start);});\n      //\n      bar.filter((d) => { return !d.isComputed }).append(\"line\")\n          .attr(\"class\", \"connector\")\n          .attr(\"x1\", barWidth )\n          .attr(\"y1\", function(d) { return y(d.end) } )\n          .attr(\"x2\", x.bandwidth() + 10 ) // / ( 1 - me.barPadding) - 5\n          .attr(\"y2\", function(d) { return y(d.end) } )\n\n      me._addLegend();\n    },\n\n    barClick(d, i){\n      this.fire('bar-click', {data: d, index: i}, {\n        bubbles: false\n      });\n    },\n\n    _wrapText(text, width) {\n      text.each(function() {\n        var text = d3.select(this),\n            words = text.text().split(/\\s+/).reverse(),\n            word,\n            line = [],\n            lineNumber = 0,\n            lineHeight = 1.1, // ems\n            y = text.attr(\"y\"),\n            dy = parseFloat(text.attr(\"dy\")),\n            tspan = text.text(null).append(\"tspan\").attr(\"x\", 0).attr(\"y\", y).attr(\"dy\", dy + \"em\");\n\n        while (word = words.pop()) {\n          line.push(word);\n          tspan.text(line.join(\" \"));\n          var compTextLen = tspan.node().getComputedTextLength();\n\n          if(compTextLen == 0){\n            compTextLen = tspan.node().innerHTML.length * 4.8\n          }\n\n          if (compTextLen > width) {\n            line.pop();\n            tspan.text(line.join(\" \"));\n            line = [word];\n            // console.log(\"test new wrap\", y, tspan.node().innerHTML);\n            tspan = text.append(\"tspan\").attr(\"x\", 0).attr(\"y\", y).attr(\"dy\", ++lineNumber * lineHeight + dy + \"em\").text(word);\n          }\n        }\n      });\n    },\n\n    _addLegend(){\n      if(!this.legends || this.legends.length == 0)\n        return false;\n\n      for(let i=0; i<this.legends.length; i++){\n        let legWrap = d3.select(this.$.legendWrap)\n          .append(\"span\").attr(\"class\",\"legend-wrap\");\n\n        legWrap.append(\"span\").attr(\"class\",\"leg-text\")\n          .attr(\"style\", \"border-left: .3rem solid \"+this.legends[i].color)\n          .text(this.legends[i].label);\n      }\n    },\n\n    _dataChanged(newData, oldData){\n      if(newData) {\n\t\t\t\tPolymer.dom(this.$.waterSVG).node.innerHTML = \"\";\n        Polymer.dom(this.$.legendWrap).node.innerHTML = \"\";\n\t\t\t\tthis.draw();\n\t\t\t}\n    },\n\n    redraw(){\n\t\t\tPolymer.dom(this.$.waterSVG).node.innerHTML = \"\";\n      Polymer.dom(this.$.legendWrap).node.innerHTML = \"\";\n\t\t\tthis.draw();\n    }\n  });\n})();\n"]}