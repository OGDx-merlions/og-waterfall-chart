{"version":3,"sources":["og-waterfall-chart.es6.js"],"names":["Polymer","is","properties","data","type","Array","value","observer","startingValue","Object","label","floorValue","Number","ceilingValue","yAxisTicks","yTickInterval","yAxisLabel","String","isChartBuilt","Boolean","readOnly","innerDimensions","width","height","legends","color","barPadding","barMaxWidth","chartMargins","top","right","bottom","left","notResponsive","listeners","barClick","d","i","fire","index","bubbles","redrawChart","svg","d3","select","compStyles","node","parseInt","margin","clientWidth","_setInnerDimensions","remove","_buildChart","ready","scopeSubtree","$","waterSVG","attached","window","on","_resize","bind","chart","length","_processData","cumulative","currentGrp","groupName","g","values","currBar","name","isComputed","class","start","end","isStarting","push","_xyBounds","ceilDiff","max","intervalMultiplier","Math","ceil","ceilAdd","bounds","ceiling","x","scaleBand","rangeRound","paddingInner","y","scaleLinear","domain","map","_axes","axes","xAxis","axisBottom","tickFormat","l","yAxis","axisLeft","ticks","tickValues","range","_buildAxes","barWidth","bandwidth","append","attr","call","selectAll","_wrapText","tickSize","text","each","words","split","reverse","word","line","lineNumber","lineHeight","dy","parseFloat","tspan","pop","join","getComputedTextLength","_buildBars","formatComma","format","bar","enter","abs","filter","_addLegend","style","_setIsChartBuilt","leg","_dataChanged"],"mappings":"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","file":"og-waterfall-chart.js","sourcesContent":["(function() {\n  Polymer({\n\n    is: 'og-waterfall-chart',\n\n    properties:{\n      data: {\n        type: Array,\n        value: [],\n        observer: '_dataChanged'\n      },\n      startingValue: {\n        type: Object,\n        value: {\n          label: \"Clean\",\n          value: 97505\n        }\n      },\n      floorValue: {\n        type: Number,\n        value: 96000\n      },\n      ceilingValue: {\n        type: Number,\n        value: 0\n      },\n      yAxisTicks: {\n        type: Number,\n        value: 5\n      },\n      yTickInterval: {\n        type: Number,\n        value: 500\n      },\n      yAxisLabel: {\n        type: String,\n        value: \"\" //LNG mass flow in kg/h\"\n      },\n      isChartBuilt: {\n        type: Boolean,\n        value: false,\n        readOnly: true\n      },\n      innerDimensions: {\n        type: Object,\n        readOnly: true,\n        value: {\n          width: 960,\n          height: 500\n        }\n      },\n      legends: {\n        type: Array,\n        value: [\n          { label: \"Increase\", color: \"#d43875\" },\n          { label: \"Decrease\", color: \"#e2913b\" },\n          { label: \"Total\", color: \"#5fbcf8\" }\n        ]\n      },\n      //chart appearance related properties\n      width: {\n        type: String,\n        value: \"100%\"\n      },\n      height: {\n        type: String,\n        value: \"300px\"\n      },\n      barPadding: {\n        type: Number,\n        value: 0.3\n      },\n      barMaxWidth: {\n        type: Number,\n        value: 50\n      },\n      chartMargins: {\n        type: Object,\n        value: {top: 40, right: 10, bottom: 100, left: 50 }\n      },\n      notResponsive: {\n        type: Boolean,\n        value: false\n      }\n    },\n\n    listeners: {\n      'barClick': 'barClick'\n    },\n\n    barClick: function(d, i) {\n      this.fire('bar-click', {data: d, index: i}, {\n        bubbles: false\n      });\n    },\n\n    redrawChart: function(){\n      // window.setTimeout(function(){\n      var svg = d3.select(\"#waterSVG\")\n        , compStyles = d3.select(\"#chart\").node()\n        , height = parseInt(this.height)\n        , margin = this.chartMargins\n        , width = parseInt(compStyles.clientWidth) + margin.right;\n\n      // console.log(compStyles.getBoundingClientRect(), compStyles.offsetWidth);\n\n      // console.log(d3.select(\"#chart\").node().clientWidth);\n      if(compStyles.clientWidth > 0){\n        this._setInnerDimensions({\n            width: width - margin.left - margin.right,\n            height: height  - margin.top - margin.bottom\n          });\n\n        svg.select(\".container\").remove();\n        svg.select(\".legend\").remove();\n\n        this._buildChart(svg);\n      }\n    },\n\n    ready: function(){\n      this.scopeSubtree(this.$.waterSVG, true);\n    },\n\n    attached: function(){\n      if(!this.notResponsive)\n        d3.select(window).on('resize', this._resize.bind(this));\n\n      //TODO: remove this and just add a default height and width, let the window resize take care of this.\n      var compStyles = d3.select(this.$.chart).node() //window.getComputedStyle(d3.select(\"#chart\").node())\n        , clientWidth = (compStyles.clientWidth==0) ? 960 : compStyles.clientWidth\n        , width = (!this.notResponsive) ? parseInt(clientWidth) : this.width\n        , height = this.height;\n\n      var svg = d3.select(this.$.waterSVG);\n      var margin = this.chartMargins;\n\n      this._setInnerDimensions({\n          width: width - margin.left - margin.right,\n          height: this.height  - margin.top - margin.bottom\n        });\n\n      if(this.yAxisLabel != \"\")\n        margin.left += 30;\n\n      //if data is just empty then we can't continue building the chart\n      if(!this.data || this.data.length == 0)\n        return false;\n\n      this._buildChart(svg);\n    },\n\n    _processData: function(){\n      if(!this.data || this.data.length == 0)\n        return [];\n\n      var data = []\n        , cumulative = +this.startingValue\n        , currentGrp = this.data[0].groupName;\n// console.log(this.startingValue);\n      // data.push({\n      //   name: this.data[0].groupName+'Total',\n      //   end: this.startingValue.value,\n      //   start: this.floorValue,\n      //   class: 'total',\n      //   label: 'Clean' //TODO: need to make this as a property\n      // });\n      for(var i=0; i<this.data.length; i++){\n        for(var g=0; g<this.data[i].values.length; g++){\n          var currBar = this.data[i].values[g];\n          currBar.name = currBar.name + this.data[i].groupName;\n          currBar.color = this.data[i].values[g].color;\n\n          if(this.data[i].values[g].isComputed){\n            currBar.class = 'total';\n            currBar.start = this.floorValue;\n            currBar.end = cumulative;\n          }\n          else{\n            currBar.start = (cumulative < this.floorValue) ? this.floorValue : cumulative;\n            currBar.class = this.data[i].groupName;\n          }\n\n          cumulative += this.data[i].values[g].value;\n\n          if(this.data[i].values[g].isStarting){\n            currBar.end = +this.startingValue;\n            currBar.start = this.floorValue;\n            currBar.class = 'total';\n            cumulative = +this.startingValue;\n          }\n          else{\n            if(!this.data[i].values[g].isComputed)\n              currBar.end = cumulative;\n          }\n\n          currBar.label = this.data[i].values[g].label;\n          currBar.isStarting = this.data[i].values[g].isStarting;\n          currBar.isComputed = this.data[i].values[g].isComputed;\n          data.push(currBar);\n        }\n        currentGrp = this.data[i].groupName;\n\n        // if(currentGrp != this.data[i].groupNament){//create a total column\n        //   data.push({\n        //     name: 'Total' + i,\n        //     end: cumulative,\n        //     start: this.floorValue,\n        //     class: 'total',\n        //     //TODO: Need to find a better way to set the middle label\n        //     label: i==0 ? 'all degraded' : 'Clean'\n        //   });\n        // }\n      }\n\n      return data;\n    },\n\n    _xyBounds: function(data){\n      var ceilDiff = +this.ceilingValue - d3.max(data, function(d) { return d.end; })\n        , intervalMultiplier = Math.ceil(ceilDiff / this.yTickInterval)\n        , ceilAdd = intervalMultiplier * this.yTickInterval;\n\n      var bounds = {\n        ceiling: d3.max(data, function(d) { return d.end; }) + ((+this.ceilingValue == 0) ? this.yTickInterval : ceilAdd),\n        x: d3.scaleBand()\n                .rangeRound([0, this.innerDimensions.width])\n                .paddingInner(0.05),\n        y: d3.scaleLinear()\n                .rangeRound([this.innerDimensions.height, 0])\n      }\n\n      //x column domain\n      bounds.x.domain(data.map(function(d) { return d.name; }));\n      //y column domain, from 0 to the biggest end value\n      //if this chart is going to display negatives then it should use d3.min(data, function(d){ return d.start })\n      bounds.y.domain([this.floorValue, bounds.ceiling]);\n\n      return bounds;\n    },\n\n    _axes: function(data, bounds){\n      var axes = {\n        xAxis: d3.axisBottom(bounds.x).tickFormat(function(d){\n              //fetch the label field\n              //TODO: need to refactor this\n              for(var l=0; l<data.length; l++)\n                if(data[l].name == d)\n                  return data[l].label;\n            }),\n        yAxis: d3.axisLeft(bounds.y).ticks(this.yAxisTicks)\n          .tickFormat(function(d){ return d; }).tickValues(d3.range(this.floorValue, bounds.ceiling, this.yTickInterval))\n      }\n\n      return axes;\n    },\n\n    _buildAxes: function(axes, g, x){\n      //to display the X axis on the chart\n      var barWidth = (x.bandwidth() > this.barMaxWidth) ? this.barMaxWidth : x.bandwidth();\n      g.append(\"g\")\n        .attr(\"class\", \"x axis\")\n        .attr(\"transform\", \"translate(-20,\" + this.innerDimensions.height + \")\")\n        .call(axes.xAxis)\n        .selectAll(\"text\")\n        .attr(\"y\", 20)\n        .attr(\"x\", -20)\n        .attr(\"dy\", \".35em\")\n        .call(this._wrapText, barWidth);\n        // .attr(\"transform\", \"rotate(-60)\")\n        // .style(\"text-anchor\", \"end\");\n\n\n      //to display the Y axis on the chart\n      g.append(\"g\")\n          .attr(\"class\", \"y axis\")\n          .call(axes.yAxis);\n\n      g.append(\"g\")\n        .attr(\"class\", \"grid\")\n        .call(axes.yAxis\n            .tickSize(-this.innerDimensions.width)\n            .tickFormat(\"\")\n        );\n    },\n    _wrapText: function(text, width) {\n      text.each(function() {\n        var text = d3.select(this),\n            words = text.text().split(/\\s+/).reverse(),\n            word,\n            line = [],\n            lineNumber = 0,\n            lineHeight = 1.1, // ems\n            y = text.attr(\"y\"),\n            dy = parseFloat(text.attr(\"dy\")),\n            tspan = text.text(null).append(\"tspan\").attr(\"x\", 0).attr(\"y\", y).attr(\"dy\", dy + \"em\");\n        while (word = words.pop()) {\n          line.push(word);\n          tspan.text(line.join(\" \"));\n          if (tspan.node().getComputedTextLength() > width || tspan.node().getComputedTextLength() == 0) {\n            line.pop();\n            tspan.text(line.join(\" \"));\n            line = [word];\n            tspan = text.append(\"tspan\").attr(\"x\", 0).attr(\"y\", y).attr(\"dy\", ++lineNumber * lineHeight + dy + \"em\").text(word);\n          }\n        }\n      });\n    },\n    _buildBars: function(data, g, x, y){\n      var formatComma = d3.format(\",\");\n\n      //adding each bar from the data\n      //this are the columns. the gaps between them are based on the x() function created above\n      var bar = g.selectAll(\".bar\")\n          .data(data)\n          .enter().append(\"g\")\n          .attr(\"class\", function(d) { return \"bar \" + d.class })\n          .attr(\"transform\", function(d) { return \"translate(\" + x(d.name) + \",0)\"; })\n          .on(\"click\", this.barClick.bind(this));\n\n      //on each column we add the actual bars that will appear\n      //the position(\"y\") is based on either the start or end (whichever is bigger of the 2)\n      //the height of the bar is based on the difference of start and end (no negatives)\n      var barWidth = (x.bandwidth() > this.barMaxWidth) ? this.barMaxWidth : x.bandwidth();\n\n      bar.append(\"rect\")\n          .attr(\"y\", function(d) { return y( Math.max(d.start, d.end) ); })\n          .attr(\"height\", function(d) { return Math.abs( y(d.start) - y(d.end) ); })\n          .attr(\"width\", barWidth)\n          .attr(\"class\", function(d) {\n              return (d.color) ? \"\":\"no-color\";\n          })\n          .attr(\"fill\", function(d) {\n            if(d.color)\n              return d.color;\n          });\n      // if()\n      //     .attr(\"fill\");\n\n      //this is text that appears on the bar\n      bar.append(\"text\")\n          .attr(\"x\", barWidth / 2)\n          .attr(\"y\", function(d) {\n            return d.class==\"decrease\" ? y(d.end) : y(d.end) - 10;\n          })\n          .attr(\"dy\", function(d) { return ((d.class=='negative') ? '-' : '') + \".75em\" })\n          .text(function(d) { return (d.class==\"total\") ? formatComma(d.end) : formatComma(d.end - d.start);});\n\n      bar.filter(function(d) { return d.class != \"total\" }).append(\"line\")\n          .attr(\"class\", \"connector\")\n          .attr(\"x1\", barWidth )\n          .attr(\"y1\", function(d) { return y(d.end) } )\n          .attr(\"x2\", x.bandwidth() / ( 1 - this.barPadding) - 5 )\n          .attr(\"y2\", function(d) { return y(d.end) } )\n    },\n\n    _buildChart: function(svg){\n      var margin = this.chartMargins;\n\n      //transform the data that the start and end properties are added\n      //the start of each data should be the value of the cumulative value so far\n      var data = this._processData();\n\n      //setting x and y scales based on the dimensions of the SVG\n      var bounds = this._xyBounds(data)\n        , axes = this._axes(data, bounds);\n\n      var x = bounds.x\n        , y = bounds.y;\n\n      svg.attr(\"width\", this.innerDimensions.width + margin.left + margin.right)\n          .attr(\"height\", this.innerDimensions.height + margin.top + margin.bottom)//this.innerDimensions.height + margin.top + margin.bottom)\n          .append(\"g\").attr(\"class\", \"container\")\n          .attr(\"transform\", \"translate(\" + margin.left + \",\" + margin.top + \")\");\n\n      // if(!this.isChartBuilt){\n        svg.attr(\"viewBox\", \"0 0 \"+(this.innerDimensions.width + margin.left + margin.right)+\" \"+(this.innerDimensions.height + margin.top + margin.bottom));\n            // .attr(\"preserveAspectRatio\", \"xMidYMid meet\");\n      // }\n\n      var g = svg.select(\".container\");\n\n      this._buildAxes(axes, g, x);\n\n      this._buildBars(data, g, x, y);\n\n      this._addLegend(svg);\n\n      // text label for the y axis\n      if(this.yAxisLabel != \"\")\n        g.append(\"text\")\n            .attr(\"transform\", \"rotate(-90)\")\n            .attr(\"y\", 10 - margin.left)\n            .attr(\"x\", 50 - (this.height / 2))\n            .attr(\"dy\", \"1em\")\n            .style(\"text-anchor\", \"middle\")\n            .text(this.yAxisLabel);\n\n      this._setIsChartBuilt(true);\n    },\n\n    _addLegend: function(svg){\n      if(!this.legends || this.legends.length == 0)\n        return false;\n\n      var leg = svg.append(\"g\").attr(\"class\", \"legend\");\n\n      for(var i=0; i<this.legends.length; i++){\n        leg.append(\"rect\")\n        .attr(\"class\", \"leg-rect\")\n        .attr(\"x\", i * 100)\n        .attr(\"y\", 0)\n        .attr(\"width\", 3)\n        .attr(\"height\", 20)\n        .style(\"fill\", this.legends[i].color);\n\n        leg.append(\"text\")\n          .attr(\"x\", (i * 100) + 12)\n          .attr(\"y\", 0)\n          .attr(\"dy\", \"1em\")\n          .text(this.legends[i].label)\n        // .attr(\"x\", (this.width / 2))\n          // .style(\"text-anchor\", \"middle\");\n      }\n\n      // leg.attr(\"transform\", \"translate(\" + ((this.innerDimensions.width / 2) - ((this.legends.length*100 + 15*this.legends.length) / 2)) + \",0)\");\n      leg.attr(\"transform\", \"translate(\" + (this.innerDimensions.width - (this.legends.length*100 - 35*this.legends.length)) + \",5)\");\n    },\n\n    _dataChanged: function(){\n      if(this.isChartBuilt){\n        var svg = d3.select(this.$.waterSVG);\n\n        svg.selectAll(\"*\").remove();\n\n        this._buildChart(svg);\n      }\n    },\n\n    _resize: function() {\n      if(this.data || this.data.length > 0){\n        var svg = d3.select(\"#waterSVG\")\n          , compStyles = d3.select(this.$.chart).node()\n          , width = parseInt(compStyles.clientWidth)\n          , height = parseInt(this.height)\n          , margin = this.chartMargins;\n\n        this._setInnerDimensions({\n            width: width - margin.left - margin.right,\n            height: height  - margin.top - margin.bottom\n          });\n\n        svg.select(\".container\").remove();\n        svg.select(\".legend\").remove();\n\n        this._buildChart(svg);\n      }\n    }\n  });\n})();\n"]}